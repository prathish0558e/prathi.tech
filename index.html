<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>Prathi Tech — Free Tools Hub</title>
<meta name="description" content="Prathi Tech — curated free tools & student packs. Search, filter and request tools." />
<link rel="icon" href="data:;base64,iVBORw0KGgo=">
<!-- Feather icons -->
<script src="https://unpkg.com/feather-icons"></script>

<style>
  /* ----------------- THEME & RESET ----------------- */
  :root{
    --bg:#071224; --card:#0e1722; --muted:#98afc7; --text:#eaf4ff;
    --accent1:#7b61ff; --accent2:#00e6a8; --glass:rgba(255,255,255,0.03);
    --maxw:1180px; --radius:14px; --shadow:0 12px 40px rgba(0,0,0,0.45);
  }
  [data-theme="light"]{
    --bg:#f6fbff; --card:#ffffff; --muted:#4b5563; --text:#071223;
    --accent1:#5530d6; --accent2:#119688; --glass:rgba(0,0,0,0.04);
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,Arial;color:var(--text);background:var(--bg);-webkit-font-smoothing:antialiased}
  a{color:inherit;text-decoration:none}
  button{font-family:inherit}
  /* ----------------- LAYOUT ----------------- */
  .wrap{max-width:var(--maxw);margin:92px auto 88px;padding:18px}
  /* ----------------- NAVBAR ----------------- */
  .navbar{position:fixed;left:12px;right:12px;top:12px;z-index:120;padding:10px 14px;display:flex;align-items:center;justify-content:space-between;gap:12px;background:linear-gradient(180deg,var(--glass),rgba(255,255,255,0));backdrop-filter:blur(10px);border-radius:12px;border:1px solid rgba(255,255,255,0.03);box-shadow:var(--shadow)}
  .brand{display:flex;align-items:center;gap:12px}
  .logo{width:44px;height:44px;border-radius:10px;background:linear-gradient(90deg,var(--accent1),var(--accent2));display:flex;align-items:center;justify-content:center}
  .logo svg{width:20px;height:20px;opacity:.98;color:white;}
  .site-title{font-weight:800;line-height:1}
  .site-sub{font-size:12px;color:var(--muted)}
  .menu-desktop{display:none}
  .nav-actions{display:flex;gap:8px;align-items:center}
  .btn-ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);padding:8px 12px;border-radius:10px;color:var(--text);font-weight:700;display:inline-flex;align-items:center;gap:8px;cursor:pointer;transition:transform .12s,background .12s}
  .btn-ghost:hover{transform:translateY(-2px);background:var(--glass)}
  .theme-btn{padding:8px;border-radius:10px;border:0;background:linear-gradient(90deg,var(--accent1),var(--accent2));color:#041017;font-weight:800;display:inline-flex;align-items:center;gap:8px;cursor:pointer}
  .hamburger{width:46px;height:46px;border-radius:10px;background:rgba(255,255,255,0.02);display:grid;place-items:center;border:1px solid rgba(255,255,255,0.03);cursor:pointer}
  /* ----------------- MOBILE MENU ----------------- */
  .mobile-menu{position:fixed;left:12px;right:12px;top:76px;background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);backdrop-filter:blur(8px);padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,0.03);box-shadow:0 10px 40px rgba(0,0,0,0.6);display:none;z-index:119}
  .mobile-menu a{display:flex;align-items:center;gap:10px;padding:10px;border-radius:10px;font-weight:800;color:var(--muted)}
  .mobile-menu a.active{background:linear-gradient(90deg,var(--accent1),var(--accent2));color:#041017}
  /* ----------------- HERO ----------------- */
  .hero{display:grid;grid-template-columns:1fr;gap:18px;align-items:center;padding:18px 0}
  .hero-card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); border-radius:var(--radius); padding:18px; border:1px solid rgba(255,255,255,0.04); box-shadow:var(--shadow)}
  h1{margin:0;font-size:clamp(22px,6vw,34px);display:flex;align-items:center;gap:10px}
  .lead{margin-top:10px;color:var(--muted);font-size:15px}
  .cta{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
  .btn{display:inline-flex;align-items:center;gap:8px;padding:10px 14px;border-radius:12px;border:0;cursor:pointer;font-weight:800}
  .btn.primary{background:linear-gradient(90deg,var(--accent1),var(--accent2));color:#041017;box-shadow:0 10px 30px rgba(123,97,255,0.06)}
  .btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.04)}
  /* ----------------- SECTIONS ----------------- */
  section{margin-top:30px}
  .section-head{display:flex;align-items:center;justify-content:space-between;gap:12px}
  .section-head h2{margin:0;font-size:18px;display:flex;align-items:center;gap:8px}
  .muted{color:var(--muted)}
  /* toolbar / search */
  .toolbar{display:flex;gap:10px;align-items:center;flex-wrap:wrap;margin-top:12px}
  .input{padding:12px 14px;border-radius:12px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:var(--text);min-width:150px;flex:1;max-width:760px}
  .select{padding:10px 12px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:var(--text)}
  .tags{display:flex;gap:8px;flex-wrap:wrap}
  .tag{padding:8px 10px;border-radius:999px;background:rgba(255,255,255,0.02);color:var(--muted);font-weight:700;cursor:pointer}
  .tag.active{background:linear-gradient(90deg,var(--accent1),var(--accent2));color:#041017}
  /* grid */
  .grid{display:grid;grid-template-columns:1fr;gap:12px;margin-top:14px}
  .card{background:var(--card);padding:16px;border-radius:12px;border:1px solid rgba(255,255,255,0.03);box-shadow:var(--shadow);display:flex;flex-direction:column;gap:10px;transition:transform .18s,box-shadow .18s}
  .card:hover{transform:translateY(-6px);box-shadow:0 18px 48px rgba(0,0,0,0.55)}
  .card h3{margin:0;font-size:15px; display: flex; align-items: center; gap: 8px;}
  .card p{margin:0;color:var(--muted);font-size:13px}
  .card .actions{margin-top:auto;padding-top:10px;display:flex;gap:8px;flex-wrap:wrap}
  .pager{display:flex;gap:8px;flex-wrap:wrap;margin-top:12px}
  .pager button{padding:8px 10px;border-radius:8px;border:0;background:rgba(255,255,255,0.02);color:var(--muted);font-weight:800}
  .pager button.active{background:linear-gradient(90deg,var(--accent1),var(--accent2));color:#041017}
  /* contact form */
  .form{max-width:760px;background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);padding:16px;border-radius:12px;border:1px solid rgba(255,255,255,0.04)}
  .form .row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
  .form input,.form textarea{width:100%;padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:var(--text)}
  .form button{padding:10px 14px;border-radius:10px;border:0;background:linear-gradient(90deg,var(--accent1),var(--accent2));font-weight:800;color:#041017;cursor:pointer; display: inline-flex; align-items: center; gap: 8px;}
  /* footer */
  .footer{margin-top:26px;text-align:center;color:var(--muted);font-size:13px;padding-bottom:40px}
  /* reveal helper */
  .reveal{opacity:0;transform:translateY(10px);transition:all .6s cubic-bezier(.2,.9,.3,1)}
  .reveal.show{opacity:1;transform:none}
  /* canvas background */
  #bg{position:fixed;inset:0;z-index:-1}
  /* responsive */
  @media(min-width:720px){ .hero{grid-template-columns:1fr 360px} .grid{grid-template-columns:repeat(2,1fr)} .menu-desktop{display:flex; gap: 8px;} .hamburger{display:none} }
  @media(min-width:1024px){ .grid{grid-template-columns:repeat(3,1fr)} .wrap{padding:24px} }
</style>
</head>
<body data-theme="dark" aria-busy="true">

<canvas id="bg" aria-hidden="true"></canvas>

<!-- NAV -->
<header class="navbar" role="banner" aria-label="Main navigation">
  <div class="brand">
    <div class="logo" aria-hidden="true" title="Prathi Tech">
      <i data-feather="zap"></i>
    </div>
    <div>
      <div class="site-title">Prathi.Tech</div>
      <div class="site-sub">Student Tech Hub</div>
    </div>
  </div>

  <nav class="menu-desktop" aria-hidden="true">
    <button class="btn-ghost" data-route="home"><i data-feather="home"></i>Home</button>
    <button class="btn-ghost" data-route="tools"><i data-feather="tool"></i>Tools</button>
    <button class="btn-ghost" data-route="packs"><i data-feather="gift"></i>Packs</button>
    <button class="btn-ghost" data-route="learning"><i data-feather="book-open"></i>Learning</button>
    <button class="btn-ghost" data-route="contact"><i data-feather="mail"></i>Contact</button>
  </nav>

  <div class="nav-actions">
    <button id="themeToggle" class="theme-btn" aria-label="Toggle theme"><i data-feather="moon"></i></button>
    <button id="menuToggle" class="hamburger" aria-label="Open menu"><i data-feather="menu"></i></button>
  </div>
</header>

<!-- mobile menu -->
<nav id="mobileMenu" class="mobile-menu" role="menu" aria-hidden="true" style="display:none">
  <a href="#" data-route="home"><i data-feather="home"></i> Home</a>
  <a href="#" data-route="tools"><i data-feather="tool"></i> Tools</a>
  <a href="#" data-route="packs"><i data-feather="gift"></i> Packs</a>
  <a href="#" data-route="learning"><i data-feather="book-open"></i> Learning</a>
  <a href="#" data-route="contact"><i data-feather="mail"></i> Contact</a>
</nav>

<main class="wrap" id="app">

  <!-- HOME -->
  <section id="home" class="reveal" aria-labelledby="homeHeading">
    <div class="hero">
      <div>
        <h1 id="homeHeading"><i data-feather="star"></i> Prathi.Tech — Free tools for students</h1>
        <p class="lead">Curated, verified and student-friendly free tools — search, filter and request new tools. Built mobile-first with performance in mind.</p>

        <div class="cta" style="margin-top:14px">
          <button class="btn primary" data-route="tools"><i data-feather="compass"></i> Explore Tools</button>
          <button class="btn ghost" data-route="packs"><i data-feather="gift"></i> Claim Packs</button>
        </div>

        <div style="margin-top:12px;color:var(--muted);display:flex;gap:10px;align-items:center;"><i data-feather="info"></i> Tip: Press <strong>/</strong> to focus search — Press <strong>H</strong> for help.</div>
      </div>

      <aside class="hero-card" aria-label="Top picks">
        <h3 style="margin:0 0 10px"><i data-feather="thumbs-up"></i> Top picks</h3>
        <ul id="topPicks" style="padding-left:18px;margin:0;color:var(--muted);font-size:14px;list-style:none">
          <!-- Populated by JS -->
        </ul>
      </aside>
    </div>
  </section>

  <!-- TOOLS -->
  <section id="tools" class="reveal" style="display:none" aria-labelledby="toolsHeading">
    <div class="section-head">
      <h2 id="toolsHeading"><i data-feather="tool"></i> Free Tools & Resources</h2>
      <div class="muted">Safe, legal & student-friendly — <span id="itemsCount">0</span> tools loaded</div>
    </div>

    <div class="toolbar" style="margin-top:12px">
      <input id="search" class="input" placeholder="Search tools (hosting, editor, ai, design) — press / to focus">
      <select id="cat" class="select" aria-label="Category">
        <option value="all">All categories</option>
        <option value="dev">Developer</option>
        <option value="design">Design</option>
        <option value="media">Media</option>
        <option value="ml">ML/AI</option>
        <option value="cloud">Cloud</option>
        <option value="students">Students</option>
        <option value="security">Security</option>
      </select>
      <div class="tags" id="tagWrap"></div>
    </div>

    <div id="cards" class="grid" style="margin-top:12px" aria-live="polite"></div>
    <div id="pager" class="pager" role="navigation" aria-label="Pagination"></div>
  </section>

  <!-- PACKS -->
  <section id="packs" class="reveal" style="display:none">
    <div class="section-head">
      <h2><i data-feather="gift"></i> Student Packs & Offers</h2>
      <div class="muted">Claim with your student email</div>
    </div>
    <div id="packsGrid" class="grid" style="margin-top:12px"></div>
  </section>

  <!-- LEARNING -->
  <section id="learning" class="reveal" style="display:none">
    <div class="section-head">
      <h2><i data-feather="book-open"></i> Learning Resources</h2>
      <div class="muted">Courses, docs & free materials</div>
    </div>
    <div id="learnGrid" class="grid" style="margin-top:12px"></div>
  </section>

  <!-- CONTACT -->
  <section id="contact" class="reveal" style="display:none">
    <div class="section-head">
      <h2><i data-feather="mail"></i> Request a tool</h2>
      <div class="muted">Tell us which free tool/resource you want added</div>
    </div>

    <form id="contactForm" class="form" aria-label="Request form" style="margin-top:12px">
      <div class="row">
        <input name="name" class="input" placeholder="Your name" required>
        <input name="email" class="input" placeholder="Email (optional)">
      </div>
      <div style="margin-top:10px">
        <input name="tool" class="input" placeholder="Tool name (e.g. Photopea / Overleaf)" required>
      </div>
      <div style="margin-top:10px">
        <textarea name="message" rows="4" class="input" placeholder="Why this tool? (short)"></textarea>
      </div>
      <div style="margin-top:10px;display:flex;gap:10px;align-items:center">
        <button type="submit" aria-label="Send request"><i data-feather="send"></i>Send request</button>
        <div id="formNote" class="muted" style="font-size:13px">Sends to your configured backend.</div>
      </div>
    </form>
  </section>

  <div class="footer">© <span id="year"></span> Prathi.Tech — Built for students</div>
</main>

<!-- toast -->
<div id="toast" style="display:none;position:fixed;right:18px;bottom:18px;background:rgba(0,0,0,0.7);color:#fff;padding:10px 12px;border-radius:10px;z-index:150">Saved</div>

<!-- ---------- APP LOGIC ---------- -->
<script>
'use strict';

/* ---------- CONFIG ---------- */
const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbz6EoW4rw_tzmz6Ihnl6ymDJ0mzHDik8a6R5KMINMYP9yMJEi4PgjUuPtNgRNLu460/exec';
const PAGE_SIZE = 12;
const DATA_URL = './tools.json'; // Path to your new JSON file

/* ---------- GLOBALS ---------- */
let DATA = { tools: [], packs: [], learning: [] };
let currentPage = 1;

/* ---------- HELPERS ---------- */
const $ = (q, ctx = document) => ctx.querySelector(q);
const $$ = (q, ctx = document) => Array.from((ctx || document).querySelectorAll(q));

function toast(msg, ok = true) {
  const t = $('#toast');
  if (!t) return;
  t.textContent = msg;
  t.style.display = 'block';
  t.style.background = ok ? 'linear-gradient(90deg,#06d6a0,#00b3ff)' : 'linear-gradient(90deg,#ff6b6b,#d64545)';
  clearTimeout(t._hid);
  t._hid = setTimeout(() => t.style.display = 'none', 2800);
}

function renderIcons() {
  try {
    feather.replace({ 'stroke-width': 1.6, width: 18, height: 18 });
  } catch (e) {
    console.warn("Feather icons could not be rendered.", e);
  }
}

function escapeHtml(s) {
  if (!s) return '';
  return s.replaceAll('&', '&amp;').replaceAll('<', '&lt;').replaceAll('>', '&gt;').replaceAll('"', '&quot;');
}

/* ---------- APP INITIALIZATION ---------- */
document.addEventListener('DOMContentLoaded', initApp);

async function initApp() {
  document.body.setAttribute('aria-busy', 'true');
  setupEventListeners();
  handleTheme();
  startAnimatedBg();
  
  try {
    const response = await fetch(DATA_URL);
    if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
    DATA = await response.json();
    
    const startRoute = location.hash ? location.hash.substring(1) : 'home';
    navigateTo(startRoute);
    populateTopPicks();
    
  } catch (error) {
    console.error("Failed to load tool data:", error);
    toast("Could not load tool data. Please try again later.", false);
  } finally {
    $('#year').textContent = new Date().getFullYear();
    document.body.setAttribute('aria-busy', 'false');
    renderIcons();
  }
}

/* ---------- EVENT LISTENERS SETUP ---------- */
function setupEventListeners() {
  const menuToggle = $('#menuToggle');
  const mobileMenu = $('#mobileMenu');

  menuToggle?.addEventListener('click', () => {
    const isOpen = mobileMenu.style.display === 'block';
    mobileMenu.style.display = isOpen ? 'none' : 'block';
    mobileMenu.setAttribute('aria-hidden', String(isOpen));
    menuToggle.innerHTML = isOpen ? '<i data-feather="menu"></i>' : '<i data-feather="x"></i>';
    renderIcons();
  });

  // Unified navigation click handler
  document.addEventListener('click', (e) => {
    const navLink = e.target.closest('[data-route]');
    if (navLink) {
      e.preventDefault();
      const route = navLink.dataset.route;
      navigateTo(route);
      if (mobileMenu.style.display === 'block') {
        mobileMenu.style.display = 'none';
        menuToggle.innerHTML = '<i data-feather="menu"></i>';
        renderIcons();
      }
    }
    // Close menu on outside click
    if (mobileMenu.style.display === 'block' && !e.target.closest('.mobile-menu') && !e.target.closest('#menuToggle')) {
        mobileMenu.style.display = 'none';
        menuToggle.innerHTML = '<i data-feather="menu"></i>';
        renderIcons();
    }
  });

  // Keyboard shortcuts
  document.addEventListener('keydown', (e) => {
    if (e.key === '/' && document.activeElement.tagName !== 'INPUT' && document.activeElement.tagName !== 'TEXTAREA') {
      e.preventDefault();
      navigateTo('tools');
      const searchInput = $('#search');
      if (searchInput) {
        searchInput.focus();
        searchInput.select();
      }
    }
    if (e.key.toLowerCase() === 'h') {
      alert('Help:\n- Press / to focus search\n- Use menu to switch pages\n- Use Request form to add new tools.');
    }
  });

  // Contact Form
  $('#contactForm')?.addEventListener('submit', handleContactFormSubmit);
}

/* ---------- ROUTING ---------- */
function navigateTo(name) {
  if (!name) name = 'home';
  $$('main section').forEach(s => s.style.display = (s.id === name ? 'block' : 'none'));
  $$('#mobileMenu a, .menu-desktop .btn-ghost').forEach(el => {
    el.classList.toggle('active', el.dataset.route === name);
  });

  switch (name) {
    case 'tools': bootTools(); break;
    case 'packs': bootGrid('packs', DATA.packs, '#packsGrid'); break;
    case 'learning': bootGrid('learning', DATA.learning, '#learnGrid'); break;
  }
  
  history.replaceState(null, '', '#' + name);
  window.scrollTo({ top: 0, behavior: 'smooth' });
  renderIcons();
}

/* ---------- UI BOOTSTRAPPERS ---------- */
function populateTopPicks() {
    const topPicksContainer = $('#topPicks');
    if (!topPicksContainer) return;
    const picks = ["GitHub Student Developer Pack", "Google Colab", "Photopea"];
    topPicksContainer.innerHTML = DATA.tools
        .filter(t => picks.includes(t.title))
        .map(t => `<li style="display:flex;align-items:center;gap:8px"><i data-feather="${t.icon || 'box'}"></i> ${escapeHtml(t.desc)}</li>`)
        .join('');
}

function bootTools() {
  const container = $('#cards');
  if (!container || container.dataset.inited) return;
  container.dataset.inited = 'true';

  const searchEl = $('#search'), catEl = $('#cat'), tagWrap = $('#tagWrap');

  const getTags = () => Array.from(new Set(['all', ...DATA.tools.flatMap(t => t.tags || [])]));

  function drawTags(active = 'all') {
    tagWrap.innerHTML = getTags().map(t => `<div class="tag ${t === active ? 'active' : ''}" data-tag="${t}">${escapeHtml(t)}</div>`).join('');
    tagWrap.querySelectorAll('.tag').forEach(btn => btn.addEventListener('click', () => {
      tagWrap.querySelector('.tag.active')?.classList.remove('active');
      btn.classList.add('active');
      currentPage = 1;
      render();
    }));
  }

  function render() {
    const q = (searchEl.value || '').trim().toLowerCase();
    const cat = catEl.value || 'all';
    const activeTag = tagWrap.querySelector('.tag.active')?.dataset.tag || 'all';

    const filtered = DATA.tools.filter(it => {
      if (cat !== 'all' && !(it.tags || []).includes(cat)) return false;
      if (activeTag !== 'all' && !(it.tags || []).includes(activeTag)) return false;
      if (!q) return true;
      const txt = `${it.title} ${it.desc || ''} ${(it.tags || []).join(' ')}`.toLowerCase();
      return txt.includes(q);
    });

    $('#itemsCount').textContent = filtered.length.toLocaleString();
    const pages = Math.max(1, Math.ceil(filtered.length / PAGE_SIZE));
    if (currentPage > pages) currentPage = 1;
    
    const start = (currentPage - 1) * PAGE_SIZE;
    const pageItems = filtered.slice(start, start + PAGE_SIZE);

    container.innerHTML = pageItems.map(it => `
      <article class="card reveal" role="article" aria-label="${escapeHtml(it.title)}">
        <h3><i data-feather="${it.icon || 'box'}"></i>${escapeHtml(it.title)}</h3>
        <p>${escapeHtml(it.desc || '')}</p>
        <div class="actions">
          <a class="btn primary" target="_blank" rel="noopener noreferrer" href="${it.url}"><i data-feather="external-link"></i>Open</a>
        </div>
      </article>
    `).join('');

    const pager = $('#pager');
    pager.innerHTML = Array.from({ length: pages }, (_, i) => `<button class="${i + 1 === currentPage ? 'active' : ''}" data-page="${i + 1}">${i + 1}</button>`).join('');
    pager.querySelectorAll('button').forEach(b => b.addEventListener('click', () => {
      currentPage = +b.dataset.page;
      render();
      container.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }));
    
    container.querySelectorAll('.reveal').forEach((el, i) => setTimeout(() => el.classList.add('show'), i * 50));
    renderIcons();
  }

  searchEl.addEventListener('input', () => { currentPage = 1; render(); });
  catEl.addEventListener('change', () => { currentPage = 1; render(); });

  drawTags();
  render();
}

function bootGrid(name, dataArray, mountSel) {
  const mount = $(mountSel);
  if (!mount || mount.dataset.inited) return;
  mount.dataset.inited = 'true';
  mount.innerHTML = dataArray.map(it => `
    <article class="card reveal">
      <h3><i data-feather="${it.icon || 'box'}"></i>${escapeHtml(it.title)}</h3>
      <p>${escapeHtml(it.desc || '')}</p>
      <div class="actions">
        <a class="btn primary" target="_blank" rel="noopener noreferrer" href="${it.url}"><i data-feather="external-link"></i>Open</a>
      </div>
    </article>
  `).join('');
  mount.querySelectorAll('.reveal').forEach((el, i) => setTimeout(() => el.classList.add('show'), i * 50));
  renderIcons();
}

/* ---------- THEME ---------- */
function handleTheme() {
  const themeToggle = $('#themeToggle');
  const savedTheme = localStorage.getItem('prathi_theme') || (window.matchMedia('(prefers-color-scheme:dark)').matches ? 'dark' : 'light');
  
  const applyTheme = (theme) => {
    document.documentElement.setAttribute('data-theme', theme);
    localStorage.setItem('prathi_theme', theme);
    themeToggle.innerHTML = `<i data-feather="${theme === 'dark' ? 'moon' : 'sun'}"></i>`;
    renderIcons();
  };

  applyTheme(savedTheme);
  
  themeToggle.addEventListener('click', () => {
    const newTheme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
    applyTheme(newTheme);
  });
}

/* ---------- CONTACT FORM ---------- */
async function handleContactFormSubmit(e) {
  e.preventDefault();
  const form = e.target;
  const payload = {
    name: form.name.value.trim(),
    email: form.email.value.trim(),
    tool: form.tool.value.trim(),
    message: form.message ? form.message.value.trim() : ''
  };

  if (!payload.name || !payload.tool) {
    toast('Please include name and tool', false);
    return;
  }
  if (!WEB_APP_URL) {
    toast('Contact form is not configured.', false);
    return;
  }

  try {
    const res = await fetch(WEB_APP_URL, {
      method: 'POST',
      mode: 'no-cors', // Important for simple Apps Script deployments
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(payload)
    });
    toast('Request sent ✅');
    form.reset();
  } catch (err) {
    console.error("Form submission error:", err);
    toast('Submit failed — check console for details', false);
  }
}

/* ---------- ANIMATED BACKGROUND ---------- */
function startAnimatedBg() {
  const c = $('#bg');
  if (!c) return;
  const ctx = c.getContext('2d');
  let W = c.width = innerWidth, H = c.height = innerHeight;
  let pts = [];

  const init = () => {
    pts = [];
    const N = Math.min(260, Math.round(W * H / 9000));
    for (let i = 0; i < N; i++) {
      pts.push({ x: Math.random() * W, y: Math.random() * H, r: Math.random() * 1.6 + 0.2, vx: (Math.random() - 0.5) * 0.22, vy: (Math.random() - 0.5) * 0.1, a: Math.random() * 0.6 + 0.03 });
    }
  };

  const frame = () => {
    ctx.clearRect(0, 0, W, H);
    const theme = document.documentElement.getAttribute('data-theme');
    const c1 = theme === 'light' ? 'rgba(85,48,214,0.03)' : 'rgba(123,97,255,0.02)';
    const c2 = theme === 'light' ? 'rgba(17,150,136,0.02)' : 'rgba(0,230,168,0.01)';
    const g = ctx.createLinearGradient(0, 0, W, H);
    g.addColorStop(0, c1);
    g.addColorStop(1, c2);
    ctx.fillStyle = g;
    ctx.fillRect(0, 0, W, H);

    for (const p of pts) {
      p.x += p.vx; p.y += p.vy;
      if (p.x < -10) p.x = W + 10; if (p.x > W + 10) p.x = -10;
      if (p.y < -10) p.y = H + 10; if (p.y > H + 10) p.y = -10;
      ctx.beginPath();
      ctx.fillStyle = `rgba(255,255,255,${p.a})`;
      ctx.arc(p.x, p.y, p.r, 0, Math.PI * 2);
      ctx.fill();
    }
    requestAnimationFrame(frame);
  };

  window.addEventListener('resize', () => { W = c.width = innerWidth; H = c.height = innerHeight; init(); });
  init();
  frame();
}
</script>

</body>
</html>

